<!DOCTYPE html>
<html>
    <head>
        <meta charset="Windows-1252">
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

        <title>Souk.tn - Panier - </title>
        <link rel="stylesheet" href="css/jquery.mobile-1.3.1.css">
        <link rel="stylesheet" href="css/style.css">
        <script src="js/jquery.js"></script>
        <script src="js/jquery.mobile-1.3.1.js"></script>
        <script src="js/loginlink.js"></script>
        <script type="text/javascript" src="cordova-2.7.0.js"></script>
        
        <script>
            document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady()
	{		
                var db = window.openDatabase('platforme', '1.0', 'open base', 200000);
		db.transaction(createDB, errorCB, successCB);
	}

	function createDB(tx)
		{
                    tx.executeSql('SELECT * FROM PANIER', [], querySuccess, errorCB);
		} 

		function errorCB(err)
	{
		console.log('Error processing SQL:' +err.code);
	}
        
        function querySuccess(tx, results)
        {
            for(var i=0; i<results.rows.lenght;i++ )
		{
                    alert(results.rows.item(i).nomproduit); //affichage
                }
        }

        </script>
    </head>
    <body>
        <input type="button" value="Annuler" onclick="annuler();">
         <input type="button" value="Commander" onclick="commander();">
         
    <script>
        function commander()
        {
             var db = window.openDatabase('platforme', '1.0', 'PhoneGap test', 200000);
            db.transaction(commandeQuery, errorCB);
        }
        
        function commandeQuery(tx)
        {
            tx.executeSql('SELECT * FROM PANIER', [], commandequerySuccess, errorCB);
            
            function commandequerySuccess(tx, results)
            {
                 var jsonString = JSON.stringify(results);
                    $.ajax({
                        type: 'POST',
                        data:  {data : jsonString}, 
                        //url: 'http://localhost:8081/mobile/listprodmobile/login',
                        url: 'http://10.0.2.2:8081/mobile/listprodmobile/login',
                        success: function(){
                            alert('OK');
                            tx.executeSql('DROP TABLE IF EXISTS PANIER');
                            window.localStorage.setItem("panier", 0);
                            window.location = 'index.html';
                        },
                        error: function(resultat){
                            alert(resultat);
                            alert('il y a un probleme!!');                        
                        }
                    });
            }
               
        }
        
        function annuler()
        {
            var db = window.openDatabase('platforme', '1.0', 'PhoneGap test', 200000);
            db.transaction(annulerQuery, errorCB);
        }
        
        function annulerQuery(tx)
        {
            tx.executeSql('DROP TABLE IF EXISTS PANIER');
            window.localStorage.setItem("panier", 0);
            window.location = 'index.html';
        }
        
        function errorCB(err)
	{
		console.log('Error processing SQL:' +err.code);
	}
    </script>
    </body>
</html>
